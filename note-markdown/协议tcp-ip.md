[TOC]
#第1章 计算机网络基础知识

## 1.3 协议

互联网是由与许多独立发展的网络通信技术融合而成，能够是他们之间不断融合并实现统一的正是TCP/IP技术。所以TCP/IP是通信协议的统称。

简单来说，协议就是计算机与计算机之间通过网络实现通信时事先达成的一种“约定”。这种“约定”使那些由不同厂商的设备、不同的CPU以及不同的操作系统组成的计算机之间，只要遵循相同的协议就能实现相互通信。

**分组交换协议**是指将大数据分割为一个个叫做包（Packet）的较小单位进行传输的方法。

## 1.4 协议由谁规定

为了解决各种网络产品的不兼容性，国际标准化组织（ISO）制定了与一个国际标准：开放式通信系统互联参考模型。但OSI中定义的洗协议没有被普及。TCP/IP并非ISO制定的某种国际标准，而是由IETE建议的、致力于推进其标准化作业的一种协议，目前该协议以作为业界标准。

## 1.6 OSI参考模型通信处理

OSI模型将通信协议中必要的模型分成7层，通过这些分层，使得那些比较复杂的网络协议更加简单化。**在这一模型中，每个分层都接收由它下一层所提供的特定服务，并且负责为自己的上一层提供特定的服务。上下之间夏进行交互时所遵循的约定叫做”接口“，同一层之间所进行的交互叫做”协议“。** 七层参考模型：从上到下依次是：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。



# 第2章 TCP/IP基础知识

## 2.3 互联网基础知识

**互联网定义**：互联网英文单词为”Internet”，从字面上理解，internet是指将多个网路哟连接使其构成更大的网络（网际网）。所以，将两个以太网用路由器连接是互联网；将企业内部的网络与其他企业相连接，并实现相互通信的网络也是互联网；甚至一个区域的网络与另一个区域的网络相互连接形成全世界规模的网络也可称作互联网。

**互联网与TCP/IP的关系**：互联网进行通信时，需要响应的网络协议，TCP/IP原本就是为使用互联网开发制定的协议族。因此，互联网协议就是TCP/IP，TCP/IP就是互联网协议。

## 2.4 TCP/IP 协议分层模型

### 2.4.1 TCP/IP与OSI参考协议模型

<div align="center">
    <img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/tco-ip-and-osi.png">
</div>

**硬件（物理层）**：TCP/IP的最底层是的负责数据传输的硬件。这种硬件就相当于以太网或电话线路等物理层的设备。**TCP/IP是在网络互连的设备之间能够通信的前提下才被提出的协议。**

**网络接口层（数据链路层）**：网络接口层利用以太网中的数据链路层进行通信。（没明白这层到底是做什么用的）

**互联网层（网络层）**：互联网层使用IP协议（这层有IP、ICMP、ARP三种协议），**IP协议的作用是将分组数据包发送到目的主机**，该功能具体由操作系统实现，而且连接互联网的所有主机跟路由器必须都实现IP的功能。

- IP是跨越网络传送数据包，使整个互联网都能收到数据的协议。IP协议使数据能够发送到地球的另一端，这期间它使用IP地址作为主机的标识。
- IP还隐含着数据链路层的功能。通过IP，相互通信的主机之间不论经过怎样的底层数据链路都能够实现通信。
- 虽然IP也是分组交换的一种协议，但是它不具有重发机制。即使分组数据包未能到达对端主机也不会重发。因此，属于费可靠性传输协议。
- ICMP：IP数据包在发送途中一旦发生异常导致无法到达对端目标地址时，需要给发送端发送一个发生异常的通知。ICMP就只为这一功能而定制的。它有时也被用来争端网络的健康状况。
- ARP：从分组数据包IP地址中解析出目标主机的物理地址（MAC地址）的一种协议。

**传输层**：TCP/IP的传输层具有两个代表性的协议：TCP协议和UDP协议。**传输层的主要功能就是能够让应用程序之间实现通信**。计算机内部，通常同一时间运行着多个程序。为此，必须分清是哪些程序与那哪些程序在进行通信。识别这些程序的是端口号。

- TCP是有种面向有连接的传输协议。他可以保证两端通信主机之间的通信可达。TCP能够正确处理在传输过程中丢包、传输顺序乱掉等异常情况。此外，TCP还能够有效利用带宽、缓解网络拥堵。然而、为了建立与断开连接，有时它需要至少7次的发包首保，导致网络流量浪费。此外，为了提高网络的利用率，TCP协议中定义了各种各样复杂的规范，因此不利于视频会议等场合使用。
- UDP有别于TCP，他是一种面向无连接的传输层协议。UDP不会关注对端是否真的收到了传过去的数据，如果需要检查对端是否收到分组数据包，或者对端是否连接到网络，则需要再应用程序中实现。UDP长用于分组数据较少或多播、广播通信以及视频通信等多媒体领域。

**应用层（会话层以上的分层）**：TCP/IP的分层中，将OSI参考模型中的会话层、表示层、应用层功能都集中到了应用程序中实现。这些功能有时由一个单一的程序时间，有时也可能会由多个程序实现。因此，自己看TCP/IP的应用程序功能就会发现，它不仅实现OSI模型中的应用层内容，还要实现会话层与表示层的功能。 

应用层中常见的协议有：

- **HTTP协议**：浏览器与服务器通信所用的协议是HTTP（HyperText Transfer Protocol，超文本传输协议）。所传输的数据的主要格式是HTML（HyperText Markup Language）。WWW（中文交万维网，是一种互联网数据读取的一种规范）中的HTTP属于OSI应用层的协议，而HTML属于表示层的协议（表示层协议一般规定待发送的数据应该如何编码，它的格式是怎么样的）。
- **SMTP协议**：发电子邮件时用到的协议叫做SMTP（Simple Mail Tranfer Protocol）协议。最初人们只能发送文本格式的电子邮件，然而现在，电子邮件的合适由MIME（在互联网上被广泛使用的、用来定义邮件数据格式的一种规范）协议扩展以后，就可以发送声音、图像等各式各样的信息。这里提到的MIME属于OSI参考模型的第6层---表示层。
- **FTP协议**：文件传输是指将保存在其他计算机硬盘上的文件转移到本地硬盘上，或将本地硬盘的文件传送到其他计算机硬盘上，该过程使用的协议是FTP（File Transfer Protocol）。
- **SSH协议**：在两台计算之间进行安全的信息传输的，需要用到SSH（Secure SHell）协议。
- **SNMP协议**：在TCP/IP中进行网络管理时，采用SNMP（Simple Network Management Protocol）协议。使用SNMP管理的主机、网桥、路由器等称作SNMP代理（Agent），而进行管理的那一段叫做管理器（Manager）。SNMP正是这个Manager与Agent所要用到的协议。

### 2.4.2 TCP/IP分层模型通信示例

假设甲给乙发送电子邮件，内容为：“早上好”。而从TCP/IP通信上看，是从一台计算机A想另外一台计算机B发送电子邮件。我们通过这个例子来认识下TCP/IP 通信的过程

<div align="center">
    <img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/tcp-ip-send-email.png">
</div>

1. 应用程序员处理（这块涉及应用层、表示层、会话层）

    启动应用程序新建邮件，填写收件人邮箱，再由键盘数输入邮件内容，鼠标点击“发送”按钮，就可以开始TCP/IP通信了。

    首先，应用程序中会进行编码处理，比如：电子邮件使用UTF8编码。这些编码相当于**OSI的表示层**功能。

    编码转化后，实际的邮件不一定会马上被发送出去，因为有些邮件的软件有一次同时发送多个邮件的功能，也可能会有用户点击“收信”按钮以后才一并接收新邮件的功能。**像这种何时建立通信连接何时发送数据的管理功能，属于OSI参考模型中会话层的功能**。

    应用在发送邮件的那一刻建立TCP连接，从而利用这个TCP可连接发送数据，它的过程首先是将应用数据发送给下一层的TCP，再做实际的转发处理。

2. TCP模块的处理（这块是传输层）

    TCP根据应用的指示，负责建立连接、发送数据以及断开连接。TCP提供将应用层发来的数据数顺利发送至对端的可靠传输。

    为了实现TCP的这一功能，需要在应用数据的前端附加附加一个TCP首部。TCP首部包括：源端口号、目标端口号（用以识别发送主机跟接收主机上的应用）、序号（用以发送的数据包中哪部分是数据）以及校验和。随后将TCP首部的包再发给IP。

3. IP模块的处理（这块是网络层）

    IP将传输层发过来的数据当做自己的数据，并在数据头部加上自己的IP首部。因此，IP数据包中IP首部后面紧跟着TCP首部，然后才是应用程序首部和数据本身。IP首部中包含：发送端IP地址和接收端IP地址。

    IP包生成后，参考路由控制表决定此包的路由或者主机。随后，IP包将被发送给这些路由器的或者主机网络接口的驱动程序，以实现真正发送数据。

    如果尚不知道接收端的MAC地址，可以利用ARP协议查找。只要知道了对端的MAC地址，就可以将MAC地址和IP地址交给以太网的驱动程序，实现数据传输。

4. 网络接口（以太网驱动）的处理（这块是网卡层，也叫数据链路层）

    从网络层传输过来的IP包，对于以太网驱动来说不过就是数据。给这数据附加上以太网首部并进行发送处理。以太网首部中包含：接收端MAC地址、发送端MAC地址和标志以太网类型的以太网数据的协议。**根据上述信息产生的以太网数据包将通过物理层传输给接收端**。

    <div align="center">
    <img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/data-link-layer.png">
    </div>

    分组数据包，经过以太网的数据链路层时的大致流程如上图所示（对各个包首部做了简化）。包流动时，从前往后依次被附加了以太网包首部、IP包首部、TCP包首部以及应用程序自己的包首部和数据。而包的最后则追加了以太网包尾。

    每个包首部中至少会包含两个信息：一个是发送端和接收端地址，另一个是上一层协议的类型。

    进过每个协议分层时，都必须有识别包发送端和接收端的信息。以太网会用MAC地址，IP会用IP地址，TCP会用端口号识别两主机的地址。即使在应用程序中，像电子邮件地址这样的信息也是一种地址标识。这些地址信息都会在每个包经由各个分层时，附加到协议对应的包首部里面。
    
    此外，每个包首部中还包含一个识别位，它是用来表示上一层协议的种类信息。例如以太网的包首部中的以太网类型，IP中的协议类型，TCP/UDP中两个端口的端口号等都起着识别类型的作用。就是在应用的首部信息中，有时也会包含一个用来识别其数据类型的标签。

# 第3章 数据链路

## 3.1 数据链路的作用

数据链路，指OSI参考模型中数据链路层，**这层的主要做用是在互连同一种数据链路的节点之间进行包传递（比如：连接到统一个交换机的三台电脑，他们就是连接到同一链路的三个节点）。**。数据链路层的协议定义了通过通讯媒介互连的设备之间传输的规范。通讯媒介包括双绞线电缆、同轴电缆、光纤、电波以及红外线灯介质。此外，各个设备之间有时也会通过交换机、网桥、中继器等中转数据。

实际上，各个设备之间在数据传输时，数据链路层和物理层是必不可少的。众所周知，计算机以二进制0和1表示信息，然而实际的通信媒介之间处理的却是电压高低、光的闪灭以及电波的强弱信号。把这些信号与二进制的0、1进行转化正是物理层的责任。数据链路层处理的数据也不是单纯的0、1序列，该层把他们集合为一个叫做“帧”的块，然后再进行数据传输。

数据链路层也可被视为网络传输中的最小单位，仔细观察，联通全世界的互联网也是由众多这样的数据链路组成的，因此又可称互联网为“数据链路的组合”。

## 3.2 数据链路相关技术

### 3.2.1 MAC地址

MAC地址用来识别数据链路中互联的节点，无论是有线连接还是无线连接的设备都有MAC地址。而且这些MAC地址不会重复。

MAC地址长48比特（48位），结构如下图所示，在使用网卡（NIC）的情况下，MAC地址一般会被烧入到ROM中。因此，任何一个网卡的MAC地址都是唯一的，在全世界都不会有重复。

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/MAC-address-format.png">
</div>

### 3.2.2 非共享介质型网络

从通信介质的使用方法上看，网络可分为共享介质型和非共享介质型。

**共享介质型网络指由多个设备共享一个通讯介质的网络**。最早的以太网和FDDI就是介质共享型网络。

非共享介质型网络是指不共享介质，在这种方式下，网络中的每个站直连交换机，由交换机负责转发数据帧。此方式下，发送端与接收端并不共享通信介质，因此很多情况下采用全双工通信方式。

不仅ATM采用这种传输控制方式，目前它也称为以太网的主流方式。通过以太网交换机构架网络，从而使计算机与交换机端口之间形成一对一的连接，即可实现全双工通信，而且一对一连接的全双工通信的方式不会发生冲突。该方式还可以根据交换机的高级特性构建虚拟局域网（VLAN，Virtual LAN）、进行流量控制等。当然这个方式也有个致命的弱点，那就是一旦交换机发生故障，与之相连接的所有计算机都将无法通信。

## 3.3 以太网

在众多数据链路中最为著名的、使用最广泛的是以太网（Ethernet，Enter是介质的意思）。它被广泛的用来构建**局域网**。

**以太网连接形式**： 在以太网普及之处，一般采用多台终端使用同一根**同轴电缆的共享介质型连接方式**。二现在，随着互连设备的处理能力以及传输速度的提高，一般都采用终端与交换机之间**独占电缆**的方式实现以太网通信。

**以太网的分类：**应为电缆种类的不用以及通信速度的差异，衍生出了众多不用的以太网类型。简单统计就有15中以太网类型，其中10BASE2的传输速度是10Mbps，10GBASE-T的传输速度是10Gbps。

**以太网的历史：**直到现在，没有交换机的半双工通信方式以及使用同轴电缆的总线型连接方式已经渐渐退出舞台，取而代之的是，终端与交换机采用独占电缆的方式实现以太网通信。目前以太网的速度已经达到了1Gbps~10Gbps之间，可以说已经“没必要再研究其他优先局域网技术了”。

## 3.4 无线通信

无线通信通常使用电磁波，空外线，激光灯方式进行传播数据。一般在办公室的无线局域网范围内组成的较高速的连接称为无线局域网。

### 3.4.1 无线通信的种类

无线通信，依据通信距离可分为如下表所列出的类型。IEEE802委会远制定许多无线标准。**无线WAN最典型的代表就是手机，手机通过基站能够实现长距离通信。**

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/types-of-wireless-communication.png">
</div>

### 3.4.2 IEEE802.11

IEEE802.11定义了无线LAN协议（**WiFi技术用的该协议**）中物理层与数据链路层的一部分（MAC层）。IEEE802.11是所有IEEE802.11相关标准的基础。它规定：MAC层中物理地址与以太网相同，都使用MAC地址，二介质访问控制上则使用与CSAM/CD相似的CSAM/CA方式。通常采用无线基站并通过高基站实现通信。

作为一种通信方式，IEEE802.11在物理层上使用电磁波或红外线，通信速度为1Mbps或2Mbps。然而，这些通信速度在后续制定的IEEE802.11 b/g/a/n等标准中逐渐被打破，以至于现在基本不被人们使用。与802.11标准相比，后续标准的传输速度如下表所示。

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/IEEE-802.11.png">
</div>

**注：WIFI使用的是IEEE802.11b标准，最大传输速度11Mpbs**。

无线LAN的连接

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/wireless-LAN.png">
</div>

# 第4张 IP协议

IP（Internet Protocol，网际协议）是TCP/IP中至关重要的协议，主要负责将数据包发送给最终的目标计算机，因此，IP能够让世界上任何两台计算机之间进行通信。

## 4.1 IP即网际协议

IP相当于OSI参考模型中的第3层---网络层。网络层的主要作用是“实现终端节点之间的通信”。这种终端阶段之间的通信也叫“点对点（end-to-end）通信”。**数据链路层的主要作用是在互连同一种数据链路的节点之间进行包传递，而一旦跨越堆中数据链路，就需要借助网络层。网络层可以跨越不同的数据链路。即使是在不同的数据链路上也能实现两端节点之间的数据包传输**。

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/role-of-IP.png">
</div>

>**主机与节点的概念**
>
>在互联网世界中，将那些配有IP地址的设备叫做“主机”。主机可以是超大型计算机，也可以是小型计算机。这是因为互联网在当初刚发明时，只能连接大类型的设备，因此习惯上将配有IP地址的设备称为“主机”。
>
>然而，准确地说，主机定义应该是指“配有IP地址，但不进行路由控制”的设备。既有IP地址又具有路由控制能力的设备叫做“路由器”，跟主机有所区别。而节点则是主机和路由器的统称。
>
>总结来说就是：数据链路实现某一个区间（一跳）内的通信，而IP实现直至最终目标地址的通信（点对点）。



**网络层与数据链路层的关系：**数据链路层提供直连两个设备之间的通信功能。与之相比，作为网络层的IP则负责在没有直连的两个网络之间进行数据传输。那为什么一定需要这样的两个层次呢？他们之间又有什么区别？答案：数据链路层只负责某一个区间之间的通信传输，它不知道在整个传输过程中总共要经过哪几个区间，以及这些区间的先后顺序是什么。网络层中IP负责将数据包发送给最终的目标地址，它里面有详细的传输路线。

## 4.2 IP基础知识

IP大致分为三大作用模块，他们是：IP寻址、路由控制、IP分包和组包。下面是对着三个概念的简单描述。

**IP寻址：**在TCP/IP通信过程中所有的主机或路由器必须设定自己的IP地址，而且无论以太主机与那种数据链路连接，其IP地址的形式都保持不变。

**路由控制（Routing**）是指将分组数据发送到最终目标地址的功能，即使网络非常复杂，也可以通过路由控制确定到达目标地址的通路。Hop译为中文叫”跳“。他是指网络中的一个区间，IP包正是在网络中的一个掉件被转发。因此IP路由也被叫做多条路由。在每个区间内决定着包在吓一跳被转发的路径。

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/routering.png">
</div>

为了将数据包给目标主机，所有的路由器都维护着一张路由控制表（Routing Table）。该表记录IP数据在下一步应该发给那个路由器。IP包将根据这个路由表在各个数据链路上传输。

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/routing-table.png">
</div>

**IP分包和组包:** IP将待传送的数据进行分片处理（IP Fragmentation），它将较大的IP包分成多个较小的IP包，分片的包到了对端目标地址以后会再被组合起来传递给上一层。

**IP面向无连接型：**IP面向无连接，即在发包之前，不需要建立与对端的目标连接。上层如果遇到需要发送给IP的数据，该数据会立刻被压缩成IP包发送出去。

为什么要面向无连接呢？原因有两点：一是为了简化，二是为了提速。但这种方式下可能会有很多冗余的通信，为了保证数据传输的可靠性，IP的上一层TCP采用面向有连接型。IP为了把数据包发送到最终目标地址，而尽最大努力。然而，他并不做”最终受到与否的验证“，可靠性的校验由TCP来做。**总结就是：IP只负责将数据发送给目标主机，TCP则负责保证对端主机确实接收到了数据**。

## 4.3 IP地址基础知识

**IP地址定义**

IP地址（IPv4地址）由32位正整数来表示。TCP/IP通信要求将这样的IP地址分配给每一个参与通信的主机。IP地址在计算机内部以二进制方式被处理，为了人们能方便记忆，采用将32位的IP地址以每8位为一组，分成4组，每组以”.“隔开，再将每组数转换为十进制，如下所示：

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/ip.png">
</div>

IP地址总的空间大小是43亿多。但IP地址并非按照主机台数来配置，而是每一台主机上的每一块网卡（NIC）都得设IP地址。通常一块网卡只设置一个IP地址，其实一块网卡也可以设置多个IP地址。此外，一台路由器通常都会配置两个以上的忘啦，因此可以设置两个以上的IP，所以目前IPv4地址已经快枯竭了。

**IP地址的组成**

IP地址由”网络标识（网络地址）“和”主机标识（主机地址）“两部分组成。规定：网络标识必须保证相互连接的每个段地址不相重复。同一段内相连的主机必须具有相同的网络地址。统一段内的主机标识不允许重复。这样就保证了整个网络中的IP地址不会重复。

IP包被转发到某个路由器时，正是利用目标IP地址的网络标识进行路由，因为即使看不到主机标识，只要一见到网络标识就能判断出是否为该网段内的主机。

**IP地址的分类**

IP地址分为四个级别，分别为A类、B类、C类、D类。它更具IP地址中从第1位到第4位的比特列对其网络标识和主机标识进行区分。如下图所示：

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/ip-a-b-c-d.png">
</div>

A类：IP地址首位以”0“开头，范围0.0.0.0~127.0.0.0，网络标识后面的24位相当于主机识别号，可容纳16777214个主机地址。

B类：IP地址首位以”10“开头，范围128.0.0.1~191.255.0.0，网络标识后面的16位相当于主机识别号，可容纳65534个主机地址。

C类：IP地址首位以”110“开头，范围192.168.0.0~239.255.255.0，网络标识后面的8位相当于主机识别号，可容纳254个主机地址。

D类：IP地址首位以”1110“开头，范围224.0.0.0~239.255.255.255，D类没有主机地址，常被用作广播。

**目前这种对IP地址的分类方式已经不再使用了，现在大多使用子网掩码**



**子网掩码**

随着互联网的覆盖范围逐渐增大，网络地址越来越不足以应对需求，直接使用A类、B类、C类地址就显得更加浪费资源。为此，人们已经该是一种新的组合方式以减少这种浪费。

子网掩码用二进制方式表示时（有两种表示方式），也是一个32位的数字，它对应IP地址的网络部分的为全部为”1“，对用IP地址主机标识的部分则全部为”0“。因此，一个IP地址可以不再受限于自己的类别，二是可以用这样会的子网掩码自由的定位自己网络标识长度。

**CIDR（Classless Inter-Domian Routing）**:由于IP地址的越来越紧张，而却按类划分又会造成IP地址的浪费。所以，人们开始摒弃了IP地址的分类，采用任意长度分割IP地址的网络标识和主机标识。这种方式叫CIDR，意思是“无类型域间选路”。

**VLSM（Variable Length Subnet Mask）：**在CIDR被应用到互联网的初期，网络内部采用固定长度的子网掩码机制。也就是说，当子网掩码的长度被设置成/25以后，域内所有的子网掩码都得使用同样的长度。然而，有些部门可能有500台主机，另一些不能可能只有50台主机。如果全部采用统一标准，就难以架构一个高效的网络结构。为此人们提出组织内要使用 **可变长度的、高效的IP分配方式**。这种可以随机修改组织内各个部门的子网掩码长度的机就是VLSM（可变长子网掩码）。根据VLSM，当主机数为500个时，子网掩码长度为/23，当主机数为50个时，子网掩码长度为/26，从而在理论上可以将IP地址的利用率提高到50%。

有了CIDR和VLSM技术，却是缓解了全局IP地址不够用的问题。但是IP地址的绝对数本身有限的事实无法改变。

**全局地址与私有地址**

互联网中任何一台主机或路由器必须配有一个唯一的IP地址。但IP地址已经不够用了，为了缓解这个问题，又出现了私有网络的IP地址。它的地址范围如下所示：

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/private-ip-address.png">
</div>

包含在这个范围内的IP都私有IP，这个范围之外的IP地址称为全局IP（也叫公网IP）。

私有IP最早没有计划连接互联网，而只用于互联网之外的独立网络。然而，当一种能够互换私有IP与全局IP的NAT技术诞生以后，配有私有地址的主机与配有全局地址的互联网主机实现了通信。现在有很多学校、家庭、公司内部正采用在每个终端设备设置私有IP地址的放发，当需要联网时，则通过NAT进行通信。

## 4.4 路由控制

发送数据包时所使用的地址是网络层地址，即IP地址。然而仅仅有IP地址还不足以实现数据包发送到对端目标地址，在数据发送过程中还需要类似于“指明路由器或主机”的信息，以便真正发往目标地址。保存这种信息的就是**路由控制表（Routing Table）**。实现IP通信的主机和路由器必须持有一张这样的表。它们也正是在这个表格的基础上才得以进行数据包发送的。

> 路由控制表的形成方式有两种：一种是管理手动设置，另一种是路由器与其他路由器相相互交换信息时自动刷新。前者也叫静态路由控制，而后者叫做动态路由控制。为了让动态路由及时刷新路由表，在网络上互连的路由器之间必须设置好路由协议，保证正常读取路由控制信息。

IP协议始终认为路由表是正确的。然而，IP本身并没有定义制作路由控制表的协议。即IP没有制作路由控制表的机制，该表是由一个叫做“路由协议”的协议制作而成的。

IP地址的网络地址部分用于进行路由控制。下图即发送IP包的示例。

<div align="center">
<img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/routing-control-table.png">
</div>

**默认路由（Default Route）**

如果一张路由表中包含所有的网络及其子网的信息，将会造成无端的浪费。这时默认路由是不错的选择，默认路由是指路由表中任何一个地址都能与之匹配的记录。默认路由一般由标记为 `0.0.0.0/0或 default` 

**主机路由（Host Route）**

“IP地址/32” 也被称为主机路由，例如：192.168.153.15/32就是主机路由。它的意思是整个IP地址的所有位都将参与路由。进行主机路由，意味着要基于主机上网卡上配置的IP地址本身，而不是基于该地址的网络地址部分进行路由。

**环回地址**

**环回地址是在同一台计算机上的程序之间进行网络通信时所使用的一个默认地址。**计算机使用一个页数的IP地址127.0.0.1作为环回地址。与该地址具有相同意义的是一个叫做localhost的主机名。使用这个IP或主机名时，数据包不会流向网络。

