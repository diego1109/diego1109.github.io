[TOC]

# 第1章 计算机网络基础知识

## 1.3 协议

互联网是由与许多独立发展的网络通信技术融合而成，能够是他们之间不断融合并实现统一的正是TCP/IP技术。所以TCP/IP是通信协议的统称。

简单来说，协议就是计算机与计算机之间通过网络实现通信时事先达成的一种“约定”。这种“约定”使那些由不同厂商的设备、不同的CPU以及不同的操作系统组成的计算机之间，只要遵循相同的协议就能实现相互通信。

**分组交换协议**是指将大数据分割为一个个叫做包（Packet）的较小单位进行传输的方法。

## 1.4 协议由谁规定

为了解决各种网络产品的不兼容性，国际标准化组织（ISO）制定了与一个国际标准：开放式通信系统互联参考模型。但OSI中定义的洗协议没有被普及。TCP/IP并非ISO制定的某种国际标准，而是由IETE建议的、致力于推进其标准化作业的一种协议，目前该协议以作为业界标准。

## 1.6 OSI参考模型通信处理

OSI模型将通信协议中必要的模型分成7层，通过这些分层，使得那些比较复杂的网络协议更加简单化。**在这一模型中，每个分层都接收由它下一层所提供的特定服务，并且负责为自己的上一层提供特定的服务。上下之间夏进行交互时所遵循的约定叫做”接口“，同一层之间所进行的交互叫做”协议“。** 七层参考模型：从上到下依次是：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。



# 第2章 TCP/IP基础知识

## 2.3 互联网基础知识

**互联网定义**：互联网英文单词为”Internet”，从字面上理解，internet是指将多个网路哟连接使其构成更大的网络（网际网）。所以，将两个以太网用路由器连接是互联网；将企业内部的网络与其他企业相连接，并实现相互通信的网络也是互联网；甚至一个区域的网络与另一个区域的网络相互连接形成全世界规模的网络也可称作互联网。

**互联网与TCP/IP的关系**：互联网进行通信时，需要响应的网络协议，TCP/IP原本就是为使用互联网开发制定的协议族。因此，互联网协议就是TCP/IP，TCP/IP就是互联网协议。

## 2.4 TCP/IP 协议分层模型

### 2.4.1 TCP/IP与OSI参考协议模型

<div align="center">
    <img src="https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/tco-ip-and-osi.png>
</div>

**硬件（物理层）**：TCP/IP的最底层是的负责数据传输的硬件。这种硬件就相当于以太网或电话线路等物理层的设备。**TCP/IP是在网络互连的设备之间能够通信的前提下才被提出的协议。**

**网络接口层（数据链路层）**：网络接口层利用以太网中的数据链路层进行通信。（没明白这层到底是做什么用的）

**互联网层（网络层）**：互联网层使用IP协议（这层有IP、ICMP、ARP三种协议），**IP协议的作用是将分组数据包发送到目的主机**，该功能具体由操作系统实现，而且连接互联网的所有主机跟路由器必须都实现IP的功能。

- IP是跨越网络传送数据包，使整个互联网都能收到数据的协议。IP协议使数据能够发送到地球的另一端，这期间它使用IP地址作为主机的标识。
- IP还隐含着数据链路层的功能。通过IP，相互通信的主机之间不论经过怎样的底层数据链路都能够实现通信。
- 虽然IP也是分组交换的一种协议，但是它不具有重发机制。即使分组数据包未能到达对端主机也不会重发。因此，属于费可靠性传输协议。
- ICMP：IP数据包在发送途中一旦发生异常导致无法到达对端目标地址时，需要给发送端发送一个发生异常的通知。ICMP就只为这一功能而定制的。它有时也被用来争端网络的健康状况。
- ARP：从分组数据包IP地址中解析出目标主机的物理地址（MAC地址）的一种协议。

**传输层**：TCP/IP的传输层具有两个代表性的协议：TCP协议和UDP协议。**传输层的主要功能就是能够让应用程序之间实现通信**。计算机内部，通常同一时间运行着多个程序。为此，必须分清是哪些程序与那哪些程序在进行通信。识别这些程序的是端口号。

- TCP是有种面向有连接的传输协议。他可以保证两端通信主机之间的通信可达。TCP能够正确处理在传输过程中丢包、传输顺序乱掉等异常情况。此外，TCP还能够有效利用带宽、缓解网络拥堵。然而、为了建立与断开连接，有时它需要至少7次的发包首保，导致网络流量浪费。此外，为了提高网络的利用率，TCP协议中定义了各种各样复杂的规范，因此不利于视频会议等场合使用。
- UDP有别于TCP，他是一种面向无连接的传输层协议。UDP不会关注对端是否真的收到了传过去的数据，如果需要检查对端是否收到分组数据包，或者对端是否连接到网络，则需要再应用程序中实现。UDP长用于分组数据较少或多播、广播通信以及视频通信等多媒体领域。

**应用层（会话层以上的分层）**：TCP/IP的分层中，将OSI参考模型中的会话层、表示层、应用层功能都集中到了应用程序中实现。这些功能有时由一个单一的程序时间，有时也可能会由多个程序实现。因此，自己看TCP/IP的应用程序功能就会发现，它不仅实现OSI模型中的应用层内容，还要实现会话层与表示层的功能。 

应用层中常见的协议有：

- **HTTP协议**：浏览器与服务器通信所用的协议是HTTP（HyperText Transfer Protocol，超文本传输协议）。所传输的数据的主要格式是HTML（HyperText Markup Language）。WWW（中文交万维网，是一种互联网数据读取的一种规范）中的HTTP属于OSI应用层的协议，而HTML属于表示层的协议（表示层协议一般规定待发送的数据应该如何编码，它的格式是怎么样的）。
- **SMTP协议**：发电子邮件时用到的协议叫做SMTP（Simple Mail Tranfer Protocol）协议。最初人们只能发送文本格式的电子邮件，然而现在，电子邮件的合适由MIME（在互联网上被广泛使用的、用来定义邮件数据格式的一种规范）协议扩展以后，就可以发送声音、图像等各式各样的信息。这里提到的MIME属于OSI参考模型的第6层---表示层。
- **FTP协议**：文件传输是指将保存在其他计算机硬盘上的文件转移到本地硬盘上，或将本地硬盘的文件传送到其他计算机硬盘上，该过程使用的协议是FTP（File Transfer Protocol）。
- **SSH协议**：在两台计算之间进行安全的信息传输的，需要用到SSH（Secure SHell）协议。
- **SNMP协议**：在TCP/IP中进行网络管理时，采用SNMP（Simple Network Management Protocol）协议。使用SNMP管理的主机、网桥、路由器等称作SNMP代理（Agent），而进行管理的那一段叫做管理器（Manager）。SNMP正是这个Manager与Agent所要用到的协议。

### 2.4.2 TCP/IP分层模型通信示例

假设甲给乙发送电子邮件，内容为：“早上好”。而从TCP/IP通信上看，是从一台计算机A想另外一台计算机B发送电子邮件。我们通过这个例子来认识下TCP/IP 通信的过程

![](https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/tcp-ip-send-email.png)

1. 应用程序员处理（这块涉及应用层、表示层、会话层）

    启动应用程序新建邮件，填写收件人邮箱，再由键盘数输入邮件内容，鼠标点击“发送”按钮，就可以开始TCP/IP通信了。

    首先，应用程序中会进行编码处理，比如：电子邮件使用UTF8编码。这些编码相当于**OSI的表示层**功能。

    编码转化后，实际的邮件不一定会马上被发送出去，因为有些邮件的软件有一次同时发送多个邮件的功能，也可能会有用户点击“收信”按钮以后才一并接收新邮件的功能。**像这种何时建立通信连接何时发送数据的管理功能，属于OSI参考模型中会话层的功能**。

    应用在发送邮件的那一刻建立TCP连接，从而利用这个TCP可连接发送数据，它的过程首先是将应用数据发送给下一层的TCP，再做实际的转发处理。

2. TCP模块的处理（这块是传输层）

    TCP根据应用的指示，负责建立连接、发送数据以及断开连接。TCP提供将应用层发来的数据数顺利发送至对端的可靠传输。

    为了实现TCP的这一功能，需要在应用数据的前端附加附加一个TCP首部。TCP首部包括：源端口号、目标端口号（用以识别发送主机跟接收主机上的应用）、序号（用以发送的数据包中哪部分是数据）以及校验和。随后将TCP首部的包再发给IP。

3. IP模块的处理（这块是网络层）

    IP将传输层发过来的数据当做自己的数据，并在数据头部加上自己的IP首部。因此，IP数据包中IP首部后面紧跟着TCP首部，然后才是应用程序首部和数据本身。IP首部中包含：发送端IP地址和接收端IP地址。

    IP包生成后，参考路由控制表决定此包的路由或者主机。随后，IP包将被发送给这些路由器的或者主机网络接口的驱动程序，以实现真正发送数据。

    如果尚不知道接收端的MAC地址，可以利用ARP协议查找。只要知道了对端的MAC地址，就可以将MAC地址和IP地址交给以太网的驱动程序，实现数据传输。

4. 网络接口（以太网驱动）的处理（这块是网卡层，也叫数据链路层）

    从网络层传输过来的IP包，对于以太网驱动来说不过就是数据。给这数据附加上以太网首部并进行发送处理。以太网首部中包含：接收端MAC地址、发送端MAC地址和标志以太网类型的以太网数据的协议。**根据上述信息产生的以太网数据包将通过物理层传输给接收端**。

    ![data-link-layer](https://cdn.jsdelivr.net/gh/diego1109/diego1109.github.io/images/data-link-layer.png)

    分组数据包，经过以太网的数据链路层时的大致流程如上图所示（对各个包首部做了简化）。包流动时，从前往后依次被附加了以太网包首部、IP包首部、TCP包首部以及应用程序自己的包首部和数据。而包的最后则追加了以太网包尾。

    每个包首部中至少会包含两个信息：一个是发送端和接收端地址，另一个是上一层协议的类型。

    进过每个协议分层时，都必须有识别包发送端和接收端的信息。以太网会用MAC地址，IP会用IP地址，TCP会用端口号识别两主机的地址。即使在应用程序中，像电子邮件地址这样的信息也是一种地址标识。这些地址信息都会在每个包经由各个分层时，附加到协议对应的包首部里面。

    此外，每个包首部中还包含一个识别位，它是用来表示上一层协议的种类信息。例如以太网的包首部中的以太网类型，IP中的协议类型，TCP/UDP中两个端口的端口号等都起着识别类型的作用。就是在应用的首部信息中，有时也会包含一个用来识别其数据类型的标签。

